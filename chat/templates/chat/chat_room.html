<!DOCTYPE html>
<html>
<head>
    <title>Chat Room</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Chat Room: {{ room.name }}</h1>
    <div id="messages"></div>
    <input type="text" id="message" placeholder="Type your message">
    <button id="send">Send</button>

    <script>
        $('#send').click(function() {
            var message = $('#message').val();
            $.post('{% url "chat:send_message" room.id %}', {
                message: message,
                csrfmiddlewaretoken: '{{ csrf_token }}'
            }).done(function(response) {
                $('#message').val('');
            });
        });
// Get the room ID from the template context--
        // Create a new WebSocket connection
const ws = new WebSocket('ws://localhost:8000/ws/room/' + roomId + '/');

// Handle the connection being opened
ws.onopen = function(event) {
    console.log('WebSocket connection established');
};

// Handle incoming messages from the server
ws.onmessage = function(event) {
    const data = JSON.parse(event.data);
    // Display the received message in the chat interface
    const messageElement = document.createElement('div');
    messageElement.textContent = data.message;
    document.getElementById('messages').appendChild(messageElement);
};

// Handle the connection being closed
ws.onclose = function(event) {
    console.log('WebSocket connection closed');
};

// Handle errors
ws.onerror = function(event) {
    console.error('WebSocket error:', event);
};

// Send a message when the user clicks the "Send" button
document.getElementById('send').onclick = function() {
    const message = document.getElementById('message').value;
    ws.send(JSON.stringify({ message: message }));
    document.getElementById('message').value = '';
};
##
    </script>
</body>
</html>
